<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Karel Redesign IDE</title>
<style>
  body { display: flex; gap: 20px; font-family: sans-serif; padding: 20px; }
  #grid { display: grid; grid-template-columns: repeat(10, 50px); grid-template-rows: repeat(10, 50px); gap: 2px; }
  .cell { width: 50px; height: 50px; border: 1px solid #aaa; position: relative; }
  .beeper { width: 20px; height: 20px; background-color: blue; border-radius: 50%; position: absolute; bottom: 2px; right: 2px; }
  #robot { width: 40px; height: 40px; background-color: red; position: absolute; transition: all 0.3s; }
  #editor { width: 300px; height: 500px; font-family: monospace; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<div>
  <textarea id="editor" placeholder="Napiš svůj Karel kód, např.&#10;move();&#10;turnLeft();&#10;putBeeper();"></textarea>
  <br>
  <button id="runBtn">Spustit</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById('grid');
const GRID_SIZE = 10;

// Inicializace mřížky
function createGrid() {
  grid.innerHTML = '';
  for(let i=0;i<GRID_SIZE*GRID_SIZE;i++){
    const cell = document.createElement('div');
    cell.className='cell';
    cell.dataset.beepers = 0; // počet beeperů
    grid.appendChild(cell);
  }
}

createGrid();

// Robot
const robot = document.createElement('div');
robot.id = 'robot';
grid.children[0].appendChild(robot);

let posX=0, posY=0, dir='right'; // right, left, up, down

function resetRobot() {
  posX=0; posY=0; dir='right';
  updateRobotRotation();
  // Odstranit robota ze všech buněk
  document.querySelectorAll('#grid .cell').forEach(cell=>{
    if(cell.contains(robot)) cell.removeChild(robot);
  });
  grid.children[0].appendChild(robot);
  // Odstranit všechny beepery
  document.querySelectorAll('.beeper').forEach(b=>b.remove());
  document.querySelectorAll('#grid .cell').forEach(c=>c.dataset.beepers=0);
}

// --- Karel API ---
function move() {
  let dx=0, dy=0;
  if(dir==='right') dx=1;
  if(dir==='left') dx=-1;
  if(dir==='up') dy=-1;
  if(dir==='down') dy=1;
  const newX=posX+dx, newY=posY+dy;
  if(newX<0||newX>=GRID_SIZE||newY<0||newY>=GRID_SIZE) return;
  grid.children[posY*GRID_SIZE + posX].removeChild(robot);
  posX=newX; posY=newY;
  grid.children[posY*GRID_SIZE + posX].appendChild(robot);
}

function turnLeft() {
  if(dir==='up') dir='left';
  else if(dir==='left') dir='down';
  else if(dir==='down') dir='right';
  else if(dir==='right') dir='up';
  updateRobotRotation();
}

function turnRight() {
  if(dir==='up') dir='right';
  else if(dir==='right') dir='down';
  else if(dir==='down') dir='left';
  else if(dir==='left') dir='up';
  updateRobotRotation();
}

function updateRobotRotation() {
  let angle=0;
  if(dir==='up') angle=-90;
  if(dir==='down') angle=90;
  if(dir==='left') angle=180;
  robot.style.transform=`rotate(${angle}deg)`;
}

function putBeeper() {
  const cell = grid.children[posY*GRID_SIZE + posX];
  const beeper = document.createElement('div');
  beeper.className='beeper';
  cell.appendChild(beeper);
  cell.dataset.beepers = parseInt(cell.dataset.beepers)+1;
}

function pickBeeper() {
  const cell = grid.children[posY*GRID_SIZE + posX];
  if(cell.dataset.beepers>0){
    const beeper = cell.querySelector('.beeper');
    if(beeper) cell.removeChild(beeper);
    cell.dataset.beepers = parseInt(cell.dataset.beepers)-1;
  }
}

// --- Spouštění kódu ---
document.getElementById('runBtn').addEventListener('click', ()=>{
  resetRobot();
  const code = document.getElementById('editor').value;
  const commands = code.split(';').map(c=>c.trim()).filter(c=>c);
  let i=0;
  function runNext(){
    if(i>=commands.length) return;
    try {
      eval(commands[i]); // spouštíme příkaz
    } catch(e){ console.log('Chyba v příkazu:', commands[i]); }
    i++;
    setTimeout(runNext, 400); // animace krok po kroku
  }
  runNext();
});

</script>

</body>
</html>
