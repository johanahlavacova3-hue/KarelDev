<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Karel Redesign IDE</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="sidebar">
  <textarea id="editor" placeholder="Napiš svůj Karel kód"></textarea>
  <button id="runBtn">Spustit</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById('grid');
const GRID_SIZE = 13;

function createGrid() {
  grid.innerHTML = '';
  grid.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
  grid.style.gridTemplateRows = `repeat(${GRID_SIZE}, 1fr)`;
  for(let i=0;i<GRID_SIZE*GRID_SIZE;i++){
    const cell = document.createElement('div');
    cell.className='cell';
    cell.dataset.beepers = 0;
    grid.appendChild(cell);
  }
}
createGrid();

const robot = document.createElement('div');
robot.id = 'robot';
grid.appendChild(robot);

let posX=0, posY=GRID_SIZE-1, dir='right';
grid.children[posY*GRID_SIZE + posX].appendChild(robot);

function updateRobotRotation() {
  let angle=0;
  if(dir==='up') angle=-90;
  if(dir==='down') angle=90;
  if(dir==='left') angle=180;
  robot.style.transform=`rotate(${angle}deg)`;
}
updateRobotRotation();

function resetRobot() {
  posX=0; posY=GRID_SIZE-1; dir='right';
  updateRobotRotation();
  document.querySelectorAll('#grid .cell').forEach(cell=>{ if(cell.contains(robot)) cell.removeChild(robot); });
  grid.children[posY*GRID_SIZE + posX].appendChild(robot);
  document.querySelectorAll('.beeper').forEach(b=>b.remove());
  document.querySelectorAll('#grid .cell').forEach(c=>c.dataset.beepers=0);
}

function move() {
  let dx=0, dy=0;
  if(dir==='right') dx=1;
  if(dir==='left') dx=-1;
  if(dir==='up') dy=-1;
  if(dir==='down') dy=1;
  const newX=posX+dx, newY=posY+dy;
  if(newX<0||newX>=GRID_SIZE||newY<0||newY>=GRID_SIZE) return;
  grid.children[posY*GRID_SIZE + posX].removeChild(robot);
  posX=newX; posY=newY;
  grid.children[posY*GRID_SIZE + posX].appendChild(robot);
}

function turnLeft() {
  if(dir==='up') dir='left';
  else if(dir==='left') dir='down';
  else if(dir==='down') dir='right';
  else if(dir==='right') dir='up';
  updateRobotRotation();
}

function turnRight() {
  if(dir==='up') dir='right';
  else if(dir==='right') dir='down';
  else if(dir==='down') dir='left';
  else if(dir==='left') dir='up';
  updateRobotRotation();
}

function putBeeper() {
  const cell = grid.children[posY*GRID_SIZE + posX];
  const beeper = document.createElement('div');
  beeper.className='beeper';
  cell.appendChild(beeper);
  cell.dataset.beepers = parseInt(cell.dataset.beepers)+1;
}

function pickBeeper() {
  const cell = grid.children[posY*GRID_SIZE + posX];
  if(cell.dataset.beepers>0){
    const beeper = cell.querySelector('.beeper');
    if(beeper) cell.removeChild(beeper);
    cell.dataset.beepers = parseInt(cell.dataset.beepers)-1;
  }
}

document.getElementById('runBtn').addEventListener('click', ()=>{
  resetRobot();
  const code = `function main(){${document.getElementById('editor').value}} main();`;
  try { eval(code); } catch(e){ console.log('Chyba v kódu:', e); }
});
</script>

</body>
</html>
