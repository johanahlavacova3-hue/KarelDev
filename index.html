<script>
const grid = document.getElementById('grid');
const runBtn = document.getElementById('runBtn');
const editor = document.getElementById('editor');

const GRID_COLS = 7;
const GRID_ROWS = 4;

function createGrid() {
  grid.innerHTML = '';
  grid.style.gridTemplateColumns = `repeat(${GRID_COLS}, 1fr)`;
  grid.style.gridTemplateRows = `repeat(${GRID_ROWS}, 1fr)`;
  for (let i = 0; i < GRID_COLS * GRID_ROWS; i++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.beepers = 0;
    grid.appendChild(cell);
  }
}
createGrid();

const robot = document.createElement('div');
robot.id = 'robot';
grid.appendChild(robot);

let posX = 0, posY = GRID_ROWS - 1, dir = 'right';
grid.children[posY * GRID_COLS + posX].appendChild(robot);

function updateRobotRotation() {
  let angle = 0;
  if (dir === 'up') angle = -90;
  if (dir === 'down') angle = 90;
  if (dir === 'left') angle = 180;
  robot.style.transform = `rotate(${angle}deg)`;
}
updateRobotRotation();

function resetRobot() {
  posX = 0; 
  posY = GRID_ROWS - 1; 
  dir = 'right';
  updateRobotRotation();

  // odstranit robota z bunƒõk
  document.querySelectorAll('#grid .cell').forEach(cell => {
    if (cell.contains(robot)) cell.removeChild(robot);
  });

  // odstranit beepery
  document.querySelectorAll('.beeper').forEach(b => b.remove());
  document.querySelectorAll('#grid .cell').forEach(c => c.dataset.beepers = 0);

  // znovu vlo≈æit robota
  grid.children[posY * GRID_COLS + posX].appendChild(robot);
}

function move() {
  let dx = 0, dy = 0;
  if (dir === 'right') dx = 1;
  if (dir === 'left') dx = -1;
  if (dir === 'up') dy = -1;
  if (dir === 'down') dy = 1;

  const newX = posX + dx, newY = posY + dy;
  if (newX < 0 || newX >= GRID_COLS || newY < 0 || newY >= GRID_ROWS) return;
  grid.children[posY * GRID_COLS + posX].removeChild(robot);
  posX = newX;
  posY = newY;
  grid.children[posY * GRID_COLS + posX].appendChild(robot);
}

function turnLeft() {
  if (dir === 'up') dir = 'left';
  else if (dir === 'left') dir = 'down';
  else if (dir === 'down') dir = 'right';
  else if (dir === 'right') dir = 'up';
  updateRobotRotation();
}

function putBeeper() {
  const cell = grid.children[posY * GRID_COLS + posX];
  const beeper = document.createElement('div');
  beeper.className = 'beeper';
  cell.appendChild(beeper);
}

function pickBeeper() {
  const cell = grid.children[posY * GRID_COLS + posX];
  const beeper = cell.querySelector('.beeper');
  if (beeper) beeper.remove();
}

function turnRight() {
  if (dir === 'up') dir = 'right';
  else if (dir === 'right') dir = 'down';
  else if (dir === 'down') dir = 'left';
  else if (dir === 'left') dir = 'up';
  updateRobotRotation();
}

// üîÅ Spu≈°tƒõn√≠ k√≥du z editoru s automatick√Ωm resetem
runBtn.addEventListener('click', () => {
  resetRobot(); // üßπ Vyma≈æe v≈°e p≈ôed spu≈°tƒõn√≠m
  try {
    const userCode = editor.value;
    eval(userCode);
  } catch (error) {
    alert("‚ùå Chyba v k√≥du: " + error.message);
  }
});
</script>
