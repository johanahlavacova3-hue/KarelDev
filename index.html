<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Karel Redesign IDE</title>
<style>
  body { display: flex; gap: 20px; font-family: sans-serif; padding: 20px; }
  #grid { display: grid; grid-template-columns: repeat(10, 50px); grid-template-rows: repeat(10, 50px); gap: 2px; }
  .cell { width: 50px; height: 50px; border: 1px solid #aaa; position: relative; }
  #robot { width: 40px; height: 40px; background-color: red; position: absolute; transition: all 0.3s; }
  #editor { width: 300px; height: 500px; font-family: monospace; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<div>
  <textarea id="editor" placeholder="Napiš svůj Karel kód, např.&#10;move();&#10;turnLeft();"></textarea>
  <br>
  <button id="runBtn">Spustit</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById('grid');
for(let i=0;i<100;i++){
  const cell = document.createElement('div');
  cell.className='cell';
  grid.appendChild(cell);
}

// Robot
const robot = document.createElement('div');
robot.id = 'robot';
grid.children[0].appendChild(robot);

let posX=0, posY=0, dir='right'; // right, left, up, down

function move() {
  let dx=0, dy=0;
  if(dir==='right') dx=1;
  if(dir==='left') dx=-1;
  if(dir==='up') dy=-1;
  if(dir==='down') dy=1;
  const newX=posX+dx, newY=posY+dy;
  if(newX<0||newX>9||newY<0||newY>9) return;
  grid.children[posY*10 + posX].removeChild(robot);
  posX=newX; posY=newY;
  grid.children[posY*10 + posX].appendChild(robot);
}

function turnLeft() {
  if(dir==='up') dir='left';
  else if(dir==='left') dir='down';
  else if(dir==='down') dir='right';
  else if(dir==='right') dir='up';
  updateRobotRotation();
}

function turnRight() {
  if(dir==='up') dir='right';
  else if(dir==='right') dir='down';
  else if(dir==='down') dir='left';
  else if(dir==='left') dir='up';
  updateRobotRotation();
}

function updateRobotRotation() {
  let angle=0;
  if(dir==='up') angle=-90;
  if(dir==='down') angle=90;
  if(dir==='left') angle=180;
  robot.style.transform=`rotate(${angle}deg)`;
}

// Spouštění kódu
document.getElementById('runBtn').addEventListener('click', ()=>{
  const code = document.getElementById('editor').value;
  const commands = code.split(';').map(c=>c.trim()).filter(c=>c);
  let i=0;
  function runNext(){
    if(i>=commands.length) return;
    try {
      eval(commands[i]); // spouštíme příkaz
    } catch(e){ console.log('Chyba v příkazu:', commands[i]); }
    i++;
    setTimeout(runNext, 400); // animace krok po kroku
  }
  runNext();
});
</script>

</body>
</html>
